{"id":"71a62b45-5d56-4cb3-9b41-109d9473e2b3","name":"OttoFMS Application Logging","type":"script","snippet":"<fmxmlsnippet type=\"FMObjectList\"><Group groupCollapsed=\"False\" includeInMenu=\"False\" id=\"155\" name=\"OttoFMS App Log\"><Group groupCollapsed=\"False\" includeInMenu=\"False\" id=\"165\" name=\"Config\"><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"163\" name=\"Config\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>/##</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>This script is where the Otto App Log module gets its configuration</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>in the demo case we are storing those values in fields.</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>You can put them anywhere. You can even hard code them in this script</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>It&apos;s up to you</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#/</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>This is your App Log Token. You can get it from your OttoFMS Server&apos;s Configuration Page</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>e.g. https://[yourfilemakerserver.com]/otto/app/otto-settings</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"EnterYourTokenHere\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$appLogToken</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text> you will need the Server URL with https</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"EnterYourServerUrlHere\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$ottoServerUrl</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>STOP no need to edit beyond this point.</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>if this is hosted on a server</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $ottoServerUrl )]]></Calculation></Step><Step enable=\"True\" id=\"87\" name=\"Show Custom Dialog\"><Title><Calculation><![CDATA[\"Sorry, Configuration Error\"]]></Calculation></Title><Message><Calculation><![CDATA[\"We can't get a valid Otto Server URL from the setttings in the Config Script.  Please correct them.\"]]></Calculation></Message><Buttons><Button CommitState=\"True\"><Calculation><![CDATA[\"OK\"]]></Calculation></Button><Button CommitState=\"False\"><Calculation><![CDATA[\"Cancel\"]]></Calculation></Button><Button CommitState=\"False\"></Button></Buttons></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement (\"{}\";\r\r [\"token\"; $appLogToken; JSONString ];\r [\"ottoServerUrl\"; $ottoServerUrl; JSONString]\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$config]]></Calculation></Step></Script></Group><Group groupCollapsed=\"False\" includeInMenu=\"False\" id=\"159\" name=\"Public\"><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"168\" name=\"Log {level, message}\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>/##</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>sends a log message to the Otto App Log</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} json </Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} json.level the log level. one of [info, error]</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} json.message the message to send to the log</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [json.script] the script that created the log</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#/</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$logData</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($logData; \"message\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$message</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($logData; \"script\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$script</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>here we add a few other values to the log message</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r Get(FileName);\r Get(AccountName);\r $script;\r $message\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$message</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute($message; \"¶\" ; Char(9))]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$message</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( $logData;\r\r  [\"message\"; $message; JSONString]\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$logData</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculation><![CDATA[$logData]]></Calculation><Script id=\"156\" name=\"_Send Log To Otto\"></Script></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step></Script><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"167\" name=\"Get Otto Url {(path)}\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>/##</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>gets a path to the otto server using the URL in a config</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} json </Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} json.path the part of the path after the :3030</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returns {string} fullPath the full path including the base</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#/</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$json</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $json ; \"path\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$path</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Script id=\"163\" name=\"Config\"></Script></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $config ; \"ottoServerUrl\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$baseUrl</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$baseUrl & $path]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$url</Name></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$url]]></Calculation></Step></Script></Group><Group groupCollapsed=\"False\" includeInMenu=\"False\" id=\"161\" name=\"Private\"><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"156\" name=\"_Send Log To Otto\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$logEntry</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Script id=\"163\" name=\"Config\"></Script></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $config ; \"token\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$token</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $config ; \"ottoServerUrl\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$baseUrl</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$baseUrl & \"/otto/api/app-log\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$url</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( $logEntry ; \r\r [\"token\" ; $token ; JSONString ]\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$logEntry</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( \"{}\";\r\r  [\"method\"; \"POST\" ; JSONString ];\r  [\"url\" ; $url ; JSONString];\r  [\"data\"; $logEntry; JSONObject];\r  [\"headers.Content-Type\"; \"application/json\"; JSONString]\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$request</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculation><![CDATA[$request]]></Calculation><Script id=\"157\" name=\"_Log_HTTP ( {request} )\"></Script></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step></Script><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"157\" name=\"_Log_HTTP ( {request} )\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>/##</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Send a Request To an API EndPoint</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>success means the server responded. It still may respond with &quot;Bad Request&quot;</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Set $$ENV_DEBUG_HTTP to turn on logging</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} request</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} request.url the url to send the request to</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.query] name value pairs in JSON that serialize to what comes after the &quot;?&quot; in the url. For nested querystrings you can use &quot;|_&quot; and &quot;_|&quot; for &quot;[&quot; and &quot;]&quot;. Ex. customer[name] would be customer|_name_|</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.headers] value pairs to set the headers example {&quot;Accept&quot; ; &quot;application/json&quot; }</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.auth] basic auth</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [request.auth.user] basic auth user name</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [request.auth.password] basic auth pasword</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [request.data] the data to send only with POST, PUT, PATCH, For nested application/x-www-form-urlencoded data you can use &quot;|_&quot; and &quot;_|&quot; for &quot;[&quot; and &quot;]&quot;. Ex. customer[name] would be customer|_name_|</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} response</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {number} response.codethe http status code</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {string} response.status the http status message</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} response.headers the reponse headers</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} response.trace the request trace - if options.trace = true</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} response.duration the request duration - if options.duration = true</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {*} response.body the response body</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {object} error</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {number} error.errorCode</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {...}</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>version 1.7.0</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.5 major refactor 11/12/2018 - todd@geistinteractive.com - based on Generator 1 version</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.6 handles binary, and form data, also handles 100 status codes</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.6.1 fixes empty headers bug</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.6.2 fixes empty headers bug for real</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.6.4 fixes basic auth space in user name issue</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.7.0 adds nested form fields using application/x-www-form-urlencoded</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history v1.8.0 adds options for trace and duration</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@license MIT</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#/</Text></Step><Step enable=\"True\" id=\"86\" name=\"Set Error Capture\"><Set state=\"True\"></Set></Step><Step enable=\"True\" id=\"85\" name=\"Allow User Abort\"><Set state=\"False\"></Set></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| PARSE PARAMETERS |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get (ScriptParameter)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$request</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $request )]]></Calculation></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($request; \"url\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$url</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($request; \"data\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$data</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($request; \"query\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$query</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($request; \"headers\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headers</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( $request  ; \"auth\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$auth</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetAsBoolean( JSONGetElement( $request  ; \"dataQuoted\") )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$dataQuoted</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( $request  ; \"options\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$options</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE QUERY |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $query )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONListKeys ( $query ; \"\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$paramList</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue ( $paramList ; $n )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$param</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty( $param )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$queryStringList;\r$param & \"=\" & GetAsURLEncoded (JSONGetElement( $query ; $param ))\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$queryStringList</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$n + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute($queryStringList ;  \"¶\"; \"&\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$queryString</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute ( $querystring ; [\"|_\"; \"[\" ] ; [\"_|\"; \"]\" ] )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$querystring</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $queryString )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$url & \"?\" & $queryString]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$url</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE DATA |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($headers; \"Content-Type\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$ContentType</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$ContentType=\"application/octet-stream\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>----</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Pure Binary</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>----</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>there are 3 ways to pass the container data as JSON, base64 is MUCH slower than the others on large files</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $data ; \"fileName\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$name</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $data ; \"base64\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$base64</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $data ; \"varRef\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$varRef</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $data ; \"fieldRef\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$fieldRef</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ($base64)]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>this is required</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $data ; \"name\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$name</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Base64Decode ( $base64; $name  )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$BinaryFile</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[not IsEmpty ($varRef) and Left($varRef;1) = \"$\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#Todo - sanitize evaluate</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Evaluate($varRef)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$BinaryFile</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[not IsEmpty ($fieldRef)]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetField($fieldRef)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$BinaryFile</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Char(45) & Char(45) & \"data-binary @$BinaryFile\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$dataString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[$ContentType = \"multipart/form-data\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>----</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>MultiPart Form</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>----</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[True]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$MultiPartFormData</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONListValues ($Data ; \"parts\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$parts</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue ( $parts ; $n )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$part</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty( $part )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $part; \"body\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partBody</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $part ; \"Content-Type\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$type</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $type )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $part ; \"ContentType\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$type</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $part ; \"fileName\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$filename</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$type=\"application/json\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>part is applicartion json</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let(\r[\rs = Quote($partBody);\rl = Length ( s )\r];\r\rMiddle(s;2;l-2)\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partBody</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$partsString;\r\"-F \\\"\" & JSONGetElement ( $part; \"name\" ) & \"=\" & $partBody & \";\" & \"type=application/json\\\"\"\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partsString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[not IsEmpty ( $fileName )]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>part is binary</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[Length($partBody) > 1000 // we assume base64]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Base64Decode ( $partBody; $fileName )]]></Calculation></Value><Repetition><Calculation><![CDATA[$n]]></Calculation></Repetition><Name>$File</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[Left($partBody; 1 ) = \"$\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>assume $var or $$Var</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#Todo - sanitize evaluate</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Evaluate($partBody)]]></Calculation></Value><Repetition><Calculation><![CDATA[$n]]></Calculation></Repetition><Name>$File</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>field</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetField($partBody)]]></Calculation></Value><Repetition><Calculation><![CDATA[$n]]></Calculation></Repetition><Name>$File</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"@$File[\" & $n & \"]\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partBody</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$partsString;\r\"-F \\\"\" & JSONGetElement ( $part; \"name\" ) & \"=\" & $partBody & \";\" & \"type=\"& $type & \";filename=\"& $fileName & \"\\\"\"\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partsString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>all other types</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$partsString;\r\"-F \\\"\" & JSONGetElement ( $part; \"name\" ) & \"=\" & $partBody & \";\" & \"type=\" &  $type & \"\\\"\"\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$partsString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$n + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute($partsString ;  \"¶\"; \" \" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$dataString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[$ContentType = \"application/x-www-form-urlencoded\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $data )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONListKeys ( $data ; \"\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$paramList</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue ( $paramList ; $n )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$param</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty( $param )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( $data ; $param )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$value</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute ( $param ; [\"|_\"; \"[\" ] ; [\"_|\"; \"]\" ] )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$param</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$queryStringList;\r$param & \"=\" & GetAsURLEncoded ($value)\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$queryStringList</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$n + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute($queryStringList ;  \"¶\"; \"&\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$queryString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"-d \\\"\" & $queryString & \"\\\"\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$dataString</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>some API need ordered properties, since most JSON parsers&#10;       can&apos;t guarentee that, we need to treat it as string</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $Data ) and $dataQuoted]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Evaluate($data)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$data</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $data )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Char(45) & Char(45) & \"data-raw \" & Quote($data)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$dataString</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE HEADER |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>fixed #20</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $headers )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONListKeys ( $headers ; \"\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headerList</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue ( $headerList ; $n )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$header</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty( $header )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[List(\r$headerString;\r\"-H \\\"\" & $header & \": \"  & JSONGetElement( $headers ; $header ) & \"\\\"\"\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headerString</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$n + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute($headerString ;  \"¶\"; \" \" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headerString</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE AUTHENTICATION |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $auth )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( $auth ; \"user\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$userName</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( $auth ; \"password\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$password</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"-u \\\"\" &  $userName & \":\" & $password & \"\\\"\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$authString</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE METHOD |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement( Get (ScriptParameter) ; \"method\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$method</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $method )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"GET\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$method</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"-X \" & $method]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$methodString</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE OPTIONS |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let ( \r\r\t\t~isTrace = GetAsBoolean ( JSONGetElement ( $options  ; \"trace\" ) ) ; \r\r\t\tCase (\r\r\r\t\t\t\t~isTrace = 1 ; \" --trace-ascii $traceASCII\" ;\r\r\t\t\t\t\"\"\r\r\t\t\t)\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$trace</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let ( \r\r\t\t~isduration = GetAsBoolean ( JSONGetElement ( $options  ; \"duration\" ) ) ; \r\r\t\tCase (\r\r\r\t\t\t\t~isDuration = 1 ; ~isDuration ;\r\r\t\t\t\t\"\"\r\r\t\t\t)\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$duration</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| cURL OPTIONS |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Do Not Use show Error --show-error</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"-D $ResponseHeaders\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$FMOptions</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$methodString & \" \" & \r$headerString & \" \" & \r$authString & \" \" & \r$dataString & \" \" & \r$FMOptions &\r$trace]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$curlOptions</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>fixed #22</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( CurrentTimeUTCMilliseconds )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$timerStart</Name></Step><Step enable=\"True\" id=\"160\" name=\"Insert from URL\"><NoInteract state=\"True\"></NoInteract><DontEncodeURL state=\"False\"></DontEncodeURL><SelectAll state=\"True\"></SelectAll><VerifySSLCertificates state=\"False\"></VerifySSLCertificates><CURLOptions><Calculation><![CDATA[$curlOptions]]></Calculation></CURLOptions><Calculation><![CDATA[$url]]></Calculation><Text></Text><Field>$responseBody</Field></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( CurrentTimeUTCMilliseconds ) - $timerStart & \" ms\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$timerDuration</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get (LastError)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[// handles 100 continue, by getting only the last response\rLet(\r[\rr = $ResponseHeaders;\rc = PatternCount(r; \"HTTP/\");\rpstart = Position ( r; \"HTTP/\"; 1;c )\r\r];\rMiddle ( r; pstart ; 10000000 )\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$ResponseHeaders</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue($responseHeaders; 1 )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseLine1</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let(\r[\rline = $responseLine1;\rsplit = Substitute ( line; \" \" ; \"¶\" );\rcode = GetAsNumber (GetValue ( split; 2) )\r\r];\r\rJSONSetElement ( \"\" ;\r\r       [\"message\"; line; JSONString ];\r       [\"code\"; code; JSONNumber ]\r\r )\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$status</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$error = 1631]]></Calculation></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[JSONGetElement( $status ; \"code\"  ) = 0]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \r\r       [\"code\" ;  0;JSONNumber];\r       [\"status\" ; \"Insert From URL Failed with error: \" & $error & \". \" & Get(LastErrorDetail)     ; JSONString]\r\r )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$responseJSON]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE RESPONSE HEADERS |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetAsBoolean ( RightWords ( $ResponseLine1 ; 1 ) = \"OK\" ) // 👍]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$isOK</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[2]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$h</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue($ResponseHeaders ; $h )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headerLine</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty ($headerLine )]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let(\r[\rheaderLine = $headerLine;\rp = Position( headerLine ; \":\" ; 1; 1 );\r$name = Left(headerLine ; p-1 );\rvalue = Middle ( headerLine; p + 1; 10000 );\r$value = Trim(value)\r\r];\r\rvalue\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$split</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$jsonType</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( $responseHeadersJSON ; $name ; $value ; $jsonType )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseHeadersJSON</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$h + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$h</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| HANDLE RESPONSE BODY |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let(\r[\rcontentType = JSONGetElement( $responseHeadersJSON ; \"Content-Type\");\rcontentType = If( IsEmpty( contentType ) ; JSONGetElement( $responseHeadersJSON ; \"content-type\"); contentType);\rcontentType = If( IsEmpty( contentType ) ; JSONGetElement( $responseHeadersJSON ; \"content-Type\"); contentType);\rcontentType = If( IsEmpty( contentType ) ; JSONGetElement( $responseHeadersJSON ; \"Content-type\"); contentType)\r\r];\r\rcontentType\r\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$contentType</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue(\r\rSubstitute(\r   $contentType ; \";\" ; \"¶\"\r);\r\r1\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$contentType</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONString]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseBodyType</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$contentType = \"application/json\" or $contentType = \"text/javascript\"]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $responseBody; \"\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseBody</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[Left($responseBody; 1) & Right($responseBody; 1) = \"{}\"]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONObject]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseBodyType</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Calculation><![CDATA[Left($responseBody; 1) & Right($responseBody; 1) = \"[]\"]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONArray]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseBodyType</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>| PACKAGE RESPONSE |</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"{}\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"status\" ; JSONGetElement($status; \"message\"); \"\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"code\" ; JSONGetElement($status; \"code\"); JSONNumber )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"headers\" ; $responseHeadersJSON; JSONObject)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"body\" ; $responseBody ; $responseBodyType )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$duration <> 0]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"duration\" ; $timerDuration ; JSONString )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$trace <> 0]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement( $responseJSON ; \"trace\" ; $traceASCII ; JSONString )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$responseJSON</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>--------------------------------------------------------------------------------------------</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$$ENV_DEBUG_HTTP]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\" ;\r\r[\"request\"; $request; JSONObject];\r[\"curl.opts\"; $curlOptions; JSONString];\r[\"curl.url\"; $url; JSONString];\r[\"response\"; $responseJSON; JSONObject]\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$$HTTP_LOG</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$$HTTP_LOG</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$responseJSON]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step></Script></Group></Group></fmxmlsnippet>","tags":["otto","logging"],"description":"Script Module to support OttoFMS Application logging. Requires OttoFMS 4.3.0 or later","customXML":false,"dynamicFields":[]}