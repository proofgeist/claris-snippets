{"id":"c2deb88a-d5bf-49f3-9e85-80ccf47c92d7","name":"HTTPPlus Script","type":"script","snippet":"<fmxmlsnippet type=\"FMObjectList\"><Script includeInMenu=\"False\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"359\" name=\"HTTPPlus\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>/##</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Send a Request</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>   Handles Paging</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>   Allows for a Response Handler that will handle each result</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>   REQUIRES a &quot;requestScript&quot; that handles the particulars of any given API</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@dependancies HTTP Script from generator</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} request</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} request.requestScript the name of the script that will handle API Communitcation</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [request.method=GET] the method. Ex. GET, POST, PUT, PATCH, DELETE</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} request.path the part of the url that changes.</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.query] name value pairs that will make up the query</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.headers] value pairs to set the headers example {&quot;Accept&quot; ; &quot;application/json&quot; }</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {string} [request.data] the data to send only with POST, PUT, PATCH</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@param {object} [request.responseScript] the name of the script that can process the results</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} obj</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} obj.data the response data returned by the API</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnSuccess {object} obj.meta other information about the request</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {object} error</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {number} error.errorCode</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@returnError {...}</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@dependancies HTTP Script from generator</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@version 1.0.1</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history version 1.0.1 updated by todd@geistinteractive.com on 2019-05-23</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>@history version 1.0.0 created by todd@geistinteractive.com on 2019-05-16</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>#/</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"86\" name=\"Set Error Capture\"><Set state=\"True\"></Set></Step><Step enable=\"True\" id=\"85\" name=\"Allow User Abort\"><Set state=\"False\"></Set></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$params</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONGetElement ( $params ;  \"requestScript\" )]]></Calculation><Text></Text><Field>$requestScript</Field></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $requestScript )]]></Calculation></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[JSONSetElement (\"\";\r\r  [\"errorCode\"; -2; JSONNumber];\r  [\"type\"; \"Validation\"; JSONString ];\r  [\"descriptor\"; \"A requestScript is required\" ; JSONString]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONGetElement ( $params ;  \"responseScript\" )]]></Calculation><Text></Text><Field>$responseScript</Field></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONDeleteElement ( $params ;  \"responseScript\" )]]></Calculation><Text></Text><Field>$request</Field></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONDeleteElement ( $request ;  \"requestScript\" )]]></Calculation><Text></Text><Field>$request</Field></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Since this handles paging we start with a loop</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>results that are not paged will exit the first loop</Text></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>CALL REQUEST SCRIPT</Text></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculated><Calculation><![CDATA[$requestScript]]></Calculation></Calculated><Calculation><![CDATA[$request]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get(LastError)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>catch missing script</Text></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$error <> 0]]></Calculation></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[JSONSetElement (\"\";\r\r  [\"errorCode\"; $error ; JSONNumber];\r  [\"type\"; \"FM\"; JSONString ];\r  [\"descriptor\"; \"Failed to call the Request Script \" & Quote($requestScript) ; JSONString]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Get Response</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation><Text></Text><Field>$response</Field></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[JSONGetElement ( $response; \"errorCode\" ) <> 0 and JSONGetElement ( $response; \"errorCode\" ) <> \"\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Unexpected errors that should stop further paging or other processig</Text></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$response]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($response ; \"nextRequest\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$request</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONDeleteElement($response ; \"nextRequest\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$response</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($response ; \"meta\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$meta</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>process results</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Left(\r  JSONGetElement ( $response ; \"data\" ) ; 1\r) = \"[\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$IsArray</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$IsArray]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>loop through each item in the array</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>if there is a handler script then call it with the item</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>gather the results, which could include errors returned by the handlers</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $responseScript )]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>NO HANDLER - just concate the array parts - strip brackets</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONGetElement ( $response ; \"data\" )]]></Calculation><Text></Text><Field>$items</Field></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Substitute(\r\r\"BEGIN\"  & $items & \"END\";\r\r[\"BEGIN[\"; \"\"];\r[\"]END\"; \"\"]\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisArray</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $thisArray )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"null\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisArray</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"False\"></SelectAll><Calculation><![CDATA[ $thisArray & \",\"]]></Calculation><Text></Text><Field>$result</Field></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>HANDLER EXISTS - loop through item in the array and pass it to the Handler</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONListValues ( $response ; \"data\" )]]></Calculation><Text></Text><Field>$items</Field></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[GetValue($items; $n )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$item</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty ( $item )]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Calling the response Handler</Text></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculated><Calculation><![CDATA[$responseScript]]></Calculation></Calculated><Calculation><![CDATA[JSONSetElement ( \"\"; \r\r  [\"data\"; $item ; \"\"] ;\r  [\"meta\"; $meta ; \"\"]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get(LastError)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$error <> 0]]></Calculation></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[JSONSetElement (\"\";\r\r  [\"errorCode\"; $error ; JSONNumber];\r  [\"type\"; \"FM\"; JSONString ];\r  [\"descriptor\"; \"Failed to call the Response Handle Script \" & Quote($responseScript) ; JSONString]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisResult</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $thisResult )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\";\r\r\r[\"meta.Skip\" ; True ; JSONBoolean]\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisResult</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($thisResult; \"data\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisData</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $thisData ) or Left($thisData; 3 )=\"? *\"]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Quote($thisResult)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$thisData</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $thisResult ; \"meta\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$reponseMeta</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[IsEmpty ( $reponseMeta ) or Left( $reponseMeta ; 3 )=\"? *\"]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"{}\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$reponseMeta</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>if a handler returns mets.Skip then we do not want to keep the results of the handler</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $reponseMeta ; \"Skip\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$Skip</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not $Skip]]></Calculation></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[JSONGetElement ( $response; \"errorCode\" ) <> 0 and JSONGetElement ( $response; \"errorCode\" ) <> \"\"]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>There was an error</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"False\"></SelectAll><Calculation><![CDATA[ $thisData & \",\"]]></Calculation><Text></Text><Field>$errorLog</Field></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>no error</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"False\"></SelectAll><Calculation><![CDATA[ $thisData & \",\"]]></Calculation><Text></Text><Field>$result</Field></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"\" // clear for next loop]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$Skip</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>if any of the handlers returned meta.DoNotContinue exit the paging and parsing.</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $reponseMeta ; \"DoNotContinue\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$DoNotContinue</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[$DoNotContinue]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$n + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$n</Name></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>NOT AN ARRAY - no need to page.  Just package the results and exit</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONGetElement ( $response ; \"data\" )]]></Calculation><Text></Text><Field>$item</Field></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $responseScript )]]></Calculation></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculated><Calculation><![CDATA[$responseScript]]></Calculation></Calculated><Calculation><![CDATA[JSONSetElement ( \"\"; \r\r  [\"data\"; $item ; \"\"] ;\r  [\"meta\"; $meta ; \"\"]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get(LastError)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[$error <> 0]]></Calculation></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[JSONSetElement (\"\";\r\r  [\"errorCode\"; $error ; JSONNumber];\r  [\"type\"; \"FM\"; JSONString ];\r  [\"descriptor\"; \"Failed to call the Response Handle Script \" & Quote($responseScript) ; JSONString]\r\r)]]></Calculation></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement($result ; \"data\")]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$item]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONSetElement ( \"\";\r\r  [\"meta\" ; $meta; \"\"];\r  [\"data\" ; $result; \"\"]\r)]]></Calculation><Text></Text><Field>$result</Field></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>NOTE! EXIT SCRIPT</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Calls that do not need paging exit here</Text></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$result]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>NOTE! EXIT SCRIPT</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>if any of the handlers returned meta.DoNotContinue exit</Text></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[$DoNotContinue]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>gathering metas</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"False\"></SelectAll><Calculation><![CDATA[ $meta & \",\"]]></Calculation><Text></Text><Field>$metas</Field></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>there are no more request to make</Text></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[IsEmpty ( $request )]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text> the results and metas where gathered as  &quot;Array Like&quot; strings. We need to turn them into an actual Arrays</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[Let(\r[\rarray = $result;\rarray = Left(array; Length(array)-1);\rarray = \"[\" & array & \"]\"\r\r\r];\r\rarray\r\r)]]></Calculation><Text></Text><Field>$result</Field></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[Let(\r[\rarray = $metas;\rarray = Left(array; Length(array)-1);\rarray = \"[\" & array & \"]\"\r\r\r];\r\rarray\r\r)]]></Calculation><Text></Text><Field>$metas</Field></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Calculation><![CDATA[not IsEmpty ( $ErrorLog )]]></Calculation></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[Let(\r[\rarray = $ErrorLog;\rarray = Left(array; Length(array)-1);\rarray = \"[\" & array & \"]\"\r\r\r];\r\rarray\r\r)]]></Calculation><Text></Text><Field>$ErrorLog</Field></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[/*Error ( -2 ; \"Processing at least one of the results produced an error\" ; $ErrorLog )*/]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\"; \"errorCode\"; 0; JSONNumber )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Package Results, starting with error so the results are merged into that object</Text></Step><Step enable=\"True\" id=\"77\" name=\"Insert Calculated Result\"><SelectAll state=\"True\"></SelectAll><Calculation><![CDATA[JSONSetElement ( $error;\r\r  [\"meta\" ; $metas; \"\"];\r  [\"data\" ; $result; \"\"]\r)]]></Calculation><Text></Text><Field>$result</Field></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>Paged Response will exit here.</Text></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$result]]></Calculation></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step></Script></fmxmlsnippet>","tags":["http"],"description":"","customXML":false,"dynamicFields":[]}