{"id":"01442a8a-c614-40e0-a19b-32dcb803b594","name":"Doppler Module","type":"script","snippet":"<fmxmlsnippet type=\"FMObjectList\"><Group groupCollapsed=\"False\" includeInMenu=\"True\" id=\"134\" name=\"Doppler\"><Script includeInMenu=\"True\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"135\" name=\"Doppler CONFIG\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>TOKEN</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>service account token or similar</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"dp.sa.YOUR_ACTUAL_TOKEN\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$token</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>OPTIONAL VALUES</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>used as default values if not passed into subscripts</Text></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"project-slug\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$project</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[isDevServer]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"dev\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[isStagingServer]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"stg\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"125\" name=\"Else If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[isProdServer]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"prd\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"><Restore state=\"False\"></Restore></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"dev\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"https://api.doppler.com/v3\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$baseUrl</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>DO NOT EDIT BELOW THIS LINE</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"><Text>############################################################################################################</Text></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[JSONSetElement ( \"\"\r\r; [ \"project\" ; $project ; JSONString ]\r; [ \"config\" ; $config ; JSONString ]\r; [ \"token\" ; $token ; JSONString ]\r; [ \"baseUrl\" ; $baseUrl ; JSONString ]\r\r )]]></Calculation></Step></Script><Group groupCollapsed=\"False\" includeInMenu=\"True\" id=\"136\" name=\"public\"><Script includeInMenu=\"True\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"137\" name=\"List Secrets\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$par</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[IsEmpty ( $par )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"{}\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$par</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $par ; \"project\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$project</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $par ; \"config\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONListValues ( $par ; \"secrets\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$secrets</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"><Restore state=\"False\"></Restore><FlushType value=\"Always\"></FlushType></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Script id=\"135\" name=\"Doppler CONFIG\"></Script></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[IsEmpty ( $project )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( Get ( ScriptResult ) ; \"project\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$project</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[IsEmpty ( $config )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( Get ( ScriptResult ) ; \"config\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$config</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"/configs/config/secrets?project=\" & $project & \"&config=\" & $config]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$path</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[not IsEmpty ( $secrets )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$path & \"&secrets=\" & Substitute ( $secrets ; ¶ ; \",\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$path</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\"\r\r; [ \"path\" ; $path ; JSONString ]\r\r )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$data</Name></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculation><![CDATA[$data]]></Calculation><Script id=\"140\" name=\"_call Doppler API\"></Script></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Let ( [\r\rjson = $result\r; items = JSONListKeys ( json ; \"secrets\" )\r; result =  While ( [ i = 0 ; data = \"{}\" ; maxCount = ValueCount ( items ) ] ; i < maxCount ; [ i = i + 1; item = GetValue ( items; i );\r\rdata = JSONSetElement ( data\r\r; [ item ; JSONGetElement ( json ; \"secrets.\" & item & \".computed\" ) ; JSONString ]\r\r )\r\r ] ; \r\r//result\rdata\r\r )\r\r] ;\r\rresult\r\r)]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$secrets</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$secrets]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[True]]></Calculation></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[$result]]></Calculation></Step></Script></Group><Group groupCollapsed=\"False\" includeInMenu=\"True\" id=\"139\" name=\"private\"><Script includeInMenu=\"True\" SiriShortcutVisible=\"False\" runFullAccess=\"False\" id=\"140\" name=\"_call Doppler API\"><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$par</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $par ; \"path\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$path</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $par ; \"method\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$method</Name></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[IsEmpty ( $method )]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[\"GET\"]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$method</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"71\" name=\"Loop\"><Restore state=\"False\"></Restore><FlushType value=\"Always\"></FlushType></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Script id=\"135\" name=\"Doppler CONFIG\"></Script></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( Get ( ScriptResult ) ; \"token\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$token</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( Get ( ScriptResult ) ; \"baseUrl\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$baseUrl</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$baseUrl & $path]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$url</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\"\r\r; [ \"Authorization\" ; \"Bearer \" & $token ; JSONString ]\r\r )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$headers</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\"\r\r; [ \"url\" ; $url ; JSONString ]\r; [ \"method\" ; $method ; JSONString ]\r; [ \"headers\" ; $headers ; JSONObject ]\r\r )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$request</Name></Step><Step enable=\"True\" id=\"1\" name=\"Perform Script\"><Calculation><![CDATA[$request]]></Calculation><Script id=\"11\" name=\"HTTP ( {request} )\"></Script></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[Get ( ScriptResult )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $result ; \"body\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$body</Name></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONGetElement ( $result ; \"code\" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$statusCode</Name></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"68\" name=\"If\"><Restore state=\"False\"></Restore><Calculation><![CDATA[$statusCode ≥ 200 and $statusCode < 300]]></Calculation></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[$body]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$result</Name></Step><Step enable=\"True\" id=\"69\" name=\"Else\"><Restore state=\"False\"></Restore></Step><Step enable=\"True\" id=\"141\" name=\"Set Variable\"><Value><Calculation><![CDATA[JSONSetElement ( \"\"\r\r; [ \"error\" ; True ; JSONBoolean ]\r; [ \"body\" ; $body ; JSONRaw ]\r\r )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$error</Name></Step><Step enable=\"True\" id=\"70\" name=\"End If\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"72\" name=\"Exit Loop If\"><Calculation><![CDATA[True]]></Calculation></Step><Step enable=\"True\" id=\"73\" name=\"End Loop\"></Step><Step enable=\"True\" id=\"89\" name=\"# (comment)\"></Step><Step enable=\"True\" id=\"103\" name=\"Exit Script\"><Calculation><![CDATA[If ( not IsEmpty ( $error ) ; $error ; $result )]]></Calculation></Step></Script></Group></Group></fmxmlsnippet>","tags":["secrets","doppler"],"description":"List all secrets from a given Doppler environment. A great way to keep enviornment vars in sync without having to store them in your FM file","customXML":false,"dynamicFields":[]}